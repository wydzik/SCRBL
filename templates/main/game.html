{##}
{#{% extends "main/header.html" %}#}
{#{%  block content %}#}
<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->

	 <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
{#   <link rel="stylesheet" type = "text/css" href="/static/game.css">#}


    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>



    {% if title %}
        <title>SCRBL - {{ title }}</title>
    {% else %}
        <title>SCRBL</title>
{% endif %}
</head>
<body>
<div class="container">
    <div class="board">
        <table>
        <tr id = "row_1">
            <td class="dropzone" id = "tripleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleword"></td>
        </tr>
        <tr id = "row_2">
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_3">
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_4">
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
        </tr>
        <tr id = "row_5">
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_6">
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_7">
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id  = "row_8">
            <td class="dropzone" id = "tripleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id ="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleword"></td>
        </tr>
        <tr id = "row_9">
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_10">
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_11">
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_12">
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
        </tr>
        <tr id = "row_13">
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_14">
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id="doubleword"></td>
            <td class="dropzone"></td>
        </tr>
        <tr id = "row_15">
            <td class="dropzone" id = "tripleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleword"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id ="doubleletter"></td>
            <td class="dropzone"></td>
            <td class="dropzone"></td>
            <td class="dropzone" id = "tripleword" ></td>
        </tr>
</table>
</div>
      <div class="playerzone">
              <ul class="list">
                <li>
                    <h2  class="nickname">{{user.username}}</h2>
                </li>
                <li>
                    <div class = "dropzone" id ="letter">
                    </div>
                </li>
                <li>
                    <input hidden id="btn" type="button" value="Wykonaj" />

                </li>
                <li>
                    <h6 class="points">Punkty:</h6>
                </li>
                <li>
                    <h6 class="points" id = "round">Runda: </h6>
                </li>
                <li>
                    <input id="start" type="button" value="START"/>
                </li>
                  <li>
                      <div hidden id="receivedBoardState">{{ boardState }}</div>
                  </li>
              </ul>
      </div>
</div>
<style>
    table{
    width : 664px;
    height: 664px;
    margin-top: 100px;
    background: white;
}
th,td{
    border: 4px solid black;
}
h2{
    width: 270px;
    font-size: 35px;
    align-items: center;
}
#tripleword{
    background: red;

}
body{
    background: darkolivegreen;
}
#tripleletter{
    background: darkblue;
}
#doubleword{
    background: lightpink;
}
#doubleletter{
    background: lightblue;
}
.container {
  display: grid;
  grid: 50px / auto auto auto;
  grid-gap: 40px;
}
.board{
    float:left;
}
.playerzone{
    margin-top: 100px;
    float:left;
}
.list{
        background: olivedrab;
}
.letter{
    border: 1px solid #466995;
    display: inline-block;
    width: 20px;
    height: 20px;
}
#change{
    display: inline-block;
    width: 270px;
    height: 80px;
    align-content: center;
}
#letter {
    display: inline-block;
    width: 270px;
    height: 80px;
    align-content: center;

}
#draggable {
  width: 35px;
  height: 35px;
  text-align: center;
  background: lightyellow;
}
.dropzone{
    width: 40px;
    height: 40px;
    padding: 0px;
    align-items: center;
}
</style>
    <script type = "text/javascript" >
      var dragged;

/* events fired on the draggable target */
document.addEventListener("drag", function(event)
{

}, false);

document.addEventListener("dragstart", function(event)
{
  // store a ref. on the dragged elem
  dragged = event.target;
  // make it half transparent
  event.target.style.opacity = .5;
}, false);

document.addEventListener("dragend", function(event)
{
  // reset the transparency
  event.target.style.opacity = "";
}, false);

/* events fired on the drop targets */
document.addEventListener("dragover", function(event)
{
  // prevent default to allow drop
  event.preventDefault();
}, false);

document.addEventListener("dragenter", function(event)
{
  // highlight potential drop target when the draggable element enters it
  if (event.target.className == "dropzone") {
    event.target.style.background = "";
  }

}, false);

document.addEventListener("dragleave", function(event)
{
  // reset background of potential drop target when the draggable element leaves it
  if (event.target.className == "dropzone")
  {
    event.target.style.background = "";
  }
}, false);

document.addEventListener("drop", function(event)
{
  // prevent default action (open as link for some elements)
  event.preventDefault();
  // move dragged elem to the selected drop target
  if ((event.target.className == "dropzone" && event.target.childNodes.length == 0  )
      || (event.target.className == "dropzone" && (event.target.id == "letter" || event.target.id =="change")))
  {
         event.target.style.background = "";
         dragged.parentNode.removeChild(dragged);
         event.target.appendChild(dragged);
         if(!boardStateValidation())
         {
             {#alert("Położony kafelek znajduje nie graniczy z pozostałymi.")#}
             {#dragged.style.opacity = 1.0;#}
             {#var newLetterContainer = document.getElementById("letter").innerHTML + dragged.outerHTML;#}
             {#document.getElementById("letter").innerHTML = newLetterContainer;#}
             {#event.target.removeChild(dragged);#}
         }
  }
}, false);

      var letters = [
        'A', 'A', 'A', 'A', 'A', 'A', 'A', 'A', 'A', String.fromCharCode(260),
        'B', 'B', 'C', 'C', 'C',String.fromCharCode(262), 'D', 'D', 'D', 'E',
        'E', 'E', 'E', 'E', 'E', 'E',  String.fromCharCode(280), 'F', 'G', 'G',
        'H', 'H', 'I', 'I', 'I', 'I', 'I', 'I', 'I', 'I',
        'J', 'J', 'K', 'K', 'K', 'L', 'L', 'L',  String.fromCharCode(321), String.fromCharCode(321),
        'M', 'M', 'M', 'N', 'N', 'N', 'N', 'N',  String.fromCharCode(323), 'O',
        'O', 'O', 'O', 'O', 'O', String.fromCharCode(211), 'P', 'P', 'P', 'R',
        'R', 'R', 'R', 'S', 'S', 'S', 'S',  String.fromCharCode(346), 'T', 'T',
        'T', 'U', 'U', 'W', 'W', 'W', 'W', 'Y', 'Y', 'Y',
        'Y', 'Z', 'Z', 'Z', 'Z', 'Z',  String.fromCharCode(377),  String.fromCharCode(379)];
      var boardState = [];
      var firstMove = true;
      var wordsInRound = [];
      var scores = new Map([
        ["A", 1], [String.fromCharCode(260), 5], ["B", 3], ["C", 2], [String.fromCharCode(262), 6],
        ["D", 2], ["E", 1], [String.fromCharCode(280), 5], ["F", 5], ["G", 3], ["H", 3], ["I", 1], ["J", 3],
        ["K", 2], ["L", 2], [String.fromCharCode(321), 3], ["M", 2], ["N", 1], [String.fromCharCode(323), 7],
        ["O", 1], [String.fromCharCode(211), 5], ["P", 2], ["R", 1], ["S", 1], [String.fromCharCode(346), 5],
        ["T", 2], ["U", 3], ["W", 1], ["Y", 2], ["Z", 1], [String.fromCharCode(377), 9], [String.fromCharCode(379), 5]]);
      var doubleWordStates = [16,28,32,42,48,56,64,70,112,154,160,168,176,182,192,196,208];
      var doubleLetterStates = [3,11,36,38,45,52,59,92,96,98,102,108,116,122,126,128,132,165,172,179,186,188,213,221];
      var tripleWordStates = [0,7,14,105,119,210,217,224];
      var tripleLetterStates = [20,24,76,80,84,88,136,140,144,148,200,204]


function applyReceivedData(board_state)
{
    receivedBoardState =  new Array();
    boardStateAsText = board_state;
    if(boardStateAsText!="")
    {
        for (i = 0 ; i < boardStateAsText.length; i++)
        {
            if(boardStateAsText[i] == "\'")
            {
                if(boardStateAsText[i - 1] =="'")
                {
                    receivedBoardState.push('');
                }
                else if(boardStateAsText[i - 1] != " "&& boardStateAsText[i-1] != "\," && boardStateAsText[i-1] != "[")
                {
                    receivedBoardState.push(boardStateAsText[i - 1]);
                }
            }
         }
        var temp = 0;
            for(j = 1; j <16; j++)
        {
            for(i = 0; i<15; i++)
            {

                    if (receivedBoardState[temp] == undefined)
                    {
                        document.getElementById("row_" + j).children[i].innerHTML = '';
                    }
                    else
                    {
                        if(receivedBoardState[temp]=='')
                        {
                            document.getElementById("row_" + j).children[i].innerHTML = '';
                        }
                        else
                        {
                        document.getElementById("row_" + j).children[i].innerHTML = '<div class ="letter" id="draggable" draggable="false"' +
                            ' ondragstart="event.dataTransfer.setData(\'text/plain\',null)"> ' + receivedBoardState[temp] + '</div> ';
                        }
                    }
                temp++;
            }
        }
    }
    boardState = boardStateUpdate();
}
function blockLetters()
{
    var board_slots = document.getElementsByClassName("board")[0].getElementsByClassName("dropzone");
    for(i = 0 ; i < board_slots.length ; i++)
    {
        if(board_slots[i].children.length == 1)
        {
            board_slots[i].innerHTML = "<div class=\"letter\" " +
            "id=\"draggable\">" + board_slots[i].innerText + "</div>"
        }
    }
}
function boardStateUpdate()
{
    newBoardState = []
    for(j = 1; j <16; j++)
    {
        for(i = 0; i<15; i++)
        {
            newBoardState.push(document.getElementById("row_"+j).children[i].innerText);
        }
    }
    return newBoardState;
}
function boardStateValidation()
{
    var newBoardState = boardStateUpdate();
    var newWord = new String();
    var wordBoardState = [];
    var counter = 0;
    for(i = 0; i < newBoardState.length; i++)
    {
        if (newBoardState[i] != "")
        {
            counter++;
        }
    }
    if(counter >1)
    {
        for (i = 0; i < newBoardState.length; i++)
        {
            if (newBoardState[i] != ""
                && (((newBoardState[i - 1] == "") || ((i - 1) % 15 == 0) || (i - 1 < 0))
                    && ((newBoardState[i + 1] == "") || ((i + 1) % 15 == 1) || (i + 1 > 254))
                    && ((newBoardState[i - 15] == "") || (i - 15 < 0))
                    && ((newBoardState[i + 15] == "") || (i + 15 > 254))))
            {
                return false;
            }
        }

        if(newBoardState[112] == "") return false;
        for(i = 0; i < newBoardState.length; i++)
        {
            if(newBoardState[i] != "")
            {
                newWord = newWord + newBoardState[i];
                wordBoardState.push(i);
            }
        }
    return {newWord : newWord, wordBoardState : wordBoardState};
    }
    return false;
}
function countValue(listOfWords, listOfBoardStates)
{
    if (listOfWords.length == listOfBoardStates.length)
    {
        var score = 0;
        for(i = 0; i < listOfWords.length; i++)
        {
            var isDouble = false;
            var isTriple = false;
            var wordScore = 0;
            for (j = 0; j <listOfWords[i].length ; j++)
            {
                if(doubleLetterStates.includes(listOfBoardStates[i][j]))
                {
                    wordScore = wordScore +  (scores.get(listOfWords[i][j]) * 2);
                }
                else if(tripleLetterStates.includes(listOfBoardStates[i][j]))
                {
                    wordScore = wordScore + (scores.get(listOfWords[i][j]) * 3);
                }
                else if (doubleWordStates.includes(listOfBoardStates[i][j]))
                {
                    isDouble = true;
                    wordScore = wordScore + scores.get(listOfWords[i][j]);
                }
                else if (tripleWordStates.includes(listOfWords[i][j]))
                {
                    isTriple = true;
                    wordScore = wordScore + scores.get(listOfWords[i][j]);
                }
                else {
                    wordScore = wordScore + scores.get(listOfWords[i][j]);
                }
            }
            if (isTriple)
            {
                score = score + (3 * wordScore);
            }
            else if (isDouble)
            {
                score = score + (2 * wordScore);
            }
            else
            {
                score = score + wordScore;
            }
        }
        return score;
    }
    else
    {
        return false;
    }
}
function fillLetters()
{
    var dropzone_div = document.getElementById("letter");
    var letter_string =  dropzone_div.innerHTML;
    if(dropzone_div.children.length < 7)
    {
        if(letters.length < (7 - dropzone_div.children.length))
        {
             var remaining_letters = dropzone_div.children.length;
            for (i = 0; i < letters.length; i++)
            {
                var temp = Math.floor(Math.random()*letters.length);
                letter_string = letter_string +
                    '<div class ="letter" id="draggable" draggable="true"' +
                    ' ondragstart="event.dataTransfer.setData(\'text/plain\',null)">' +
                    ' '+ letters[temp]+ '</div> ';
                letters.splice(temp,1);
            }
            dropzone_div.innerHTML = letter_string;

        }
        else
        {
            var remaining_letters = dropzone_div.children.length;
            for (i = 0; i < 7- remaining_letters; i++)
            {
                var temp = Math.floor(Math.random()*letters.length);
                letter_string = letter_string +
                    '<div class ="letter" id="draggable" draggable="true"' +
                    ' ondragstart="event.dataTransfer.setData(\'text/plain\',null)">' +
                    ' '+ letters[temp]+ '</div> ';
                letters.splice(temp,1);
            }
            dropzone_div.innerHTML = letter_string
        }
    }
    return letter_string;
}
function makeMove()
{
    if (boardState.length == 0) {
        var result = boardStateValidation();
        if (result == false || result == undefined) {

        }
        else {
            var wordList = result.newWord;
            var wordListAsBoardState = result.wordBoardState;
            if (wordList) {
                boardState = boardStateUpdate();
                var remainingLetters = [];
                for (i = 0; i < document.getElementById("letter").children.length; i++) {
                    remainingLetters.push(document.getElementById("letter").children[i].innerText)
                }
                blockLetters();
                firstMove = false;
                return {
                    wordList: wordList,
                    remainingLetters: remainingLetters,
                    wordListAsBoardState: wordListAsBoardState
                };
            } else {
                alert("Słowo musi przechodzić przez środek planszy")
            }
        }
    } else {
        var result = moveValidation();
        if (result == false || result == undefined) {

        } else {
            var wordList = result.listOfWords;
            var wordListAsBoardState = result.listOfWordsAsBoardStates;
            if (wordList) {
                {#roundScore = wordScore();#}
                boardState = boardStateUpdate();
                remainingLetters = [];
                for (i = 0; i < document.getElementById("letter").children.length; i++) {
                    remainingLetters.push(document.getElementById("letter").children[i].innerText)
                }
                blockLetters();
                return {
                    wordList: wordList,
                    remainingLetters: remainingLetters,
                    wordListAsBoardState: wordListAsBoardState
                };
            } else {
                alert("Nie wszystkie kafelki stykają się z pozostałymi.")
            }
        }
    }
}
function moveValidation()
{
    var boardStateToBe = [];
    var listOfNewLetters = [];
    var listOfWords = [];
    var listOfWordsAsBoardStates = [];
    for(j = 1; j < 16; j++)
    {
        for(i = 0; i < 15; i++)
        {
            boardStateToBe.push(document.getElementById("row_" + j).children[i]);
            if(document.getElementById("row_" + j).children[i].children.length == 1
                && document.getElementById("row_" + j).children[i].children.draggable.draggable == true)
            {
                listOfNewLetters.push(boardStateToBe.length - 1)

            }
        }
    }
    console.log(boardStateToBe)
    console.log(listOfNewLetters)

    {#tutaj się musze zastanowić, czy true, czy lepiej false, żeby wymusić jakiś ruch#}
    if (listOfNewLetters.length == 0) return false;
    {#obsługa ruchu dla pojedynczej płytki#}
    else if (listOfNewLetters.length == 1)
    {
        if (((boardState[listOfNewLetters[0] - 1] == "") || ((listOfNewLetters[0] - 1) % 15 == 14) || (listOfNewLetters[0] - 1 < 0))
            && ((boardState[listOfNewLetters[0] + 1] == "") || ((listOfNewLetters[0] + 1) % 15 == 0) || (listOfNewLetters[0] + 1 > 254))
            && ((boardState[listOfNewLetters[0] - 15] == "") || (listOfNewLetters[0] - 15 < 0))
            && ((boardState[listOfNewLetters[0] + 15] == "") || (i + 15 > 254))) return false;
        else
        {
            {#po lewej są jakieś płytki#}
            if((boardState[listOfNewLetters[0] - 1] != "" && ((listOfNewLetters[0] - 1)  % 15 != 14))
                && boardState[listOfNewLetters[0] + 1] == "")
            {
                var check = true;
                var i = 1;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] - i];
                    wordBoardState.push(listOfNewLetters[0]-i);
                    i++;
                    if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0]-i) % 15 == 14)
                    {
                        check = false;
                    }
                }
                listOfWords.push(newWord.split('').reverse().join(''));
                listOfWordsAsBoardStates.push(wordBoardState.sort());
            }
            {#po prawej są płytki#}
            if((boardState[listOfNewLetters[0] + 1] != "" && ((listOfNewLetters[0] + 1) % 15 != 0))
                && boardState[listOfNewLetters[0] - 1] == "")
            {
                var check = true;
                var i = 1;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] + i];
                    wordBoardState.push(listOfNewLetters[0]+i);
                    i++;
                    if (boardState[listOfNewLetters[0] + i] == "" || (listOfNewLetters[0] + i) % 15 == 0)
                    {
                        check = false;
                    }
                }
                listOfWords.push(newWord);
                listOfWordsAsBoardStates.push(wordBoardState);
            }
            {#na górze jest kafelek#}
            if(boardState[listOfNewLetters[0] - 15] != "" && boardState[listOfNewLetters[0] + 15] == "")
            {
                var check = true;
                var i = 15;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] - i];
                    wordBoardState.push(listOfNewLetters[0]-i);
                    i += 15;
                    if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0] - i < 0)
                    {
                        check = false;
                    }
                }
                listOfWords.push(newWord.split('').reverse().join(''));
                listOfWordsAsBoardStates.push(wordBoardState.sort());
            }
            {#na dole jest kafelek#}
            if(boardState[listOfNewLetters[0] + 15] != "" && boardState[listOfNewLetters[0] - 15] == "")
            {
                var check = true;
                var i = 15;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] + i];
                    wordBoardState.push(listOfNewLetters[0] + i);
                    i += 15;
                    if (boardState[listOfNewLetters[0] + i] == "" || listOfNewLetters[0] + i > 224)
                    {
                        check = false;
                    }
                }
                listOfWords.push(newWord);
                listOfWordsAsBoardStates.push(wordBoardState);
            }
            {#po lewej i prawej są kafelki#}
            if((boardState[listOfNewLetters[0] + 1] != "" && ((listOfNewLetters[0] + 1) % 15 != 0))
                && (boardState[listOfNewLetters[0] - 1] != "" && ((listOfNewLetters[0] - 1) % 15 != 15)))
            {
                var check = true;
                var i = 1;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] - i];
                    wordBoardState.push(listOfNewLetters[0] - i);
                    i++;
                    if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0]-i % 15 == 14) {
                        check = false;
                    }
                }
                newWord = newWord.split('').reverse().join('');
                i = 1;
                while(!check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] + i];
                    wordBoardState.push(listOfNewLetters[0] - i);
                    i++;
                    if (boardState[listOfNewLetters[0] + i] == "" || listOfNewLetters[0] + i % 15 == 0) {
                        check = true;
                    }
                }
                listOfWords.push(newWord);
                listOfWordsAsBoardStates.push(wordBoardState.sort());
            }
            {#są kafelki po lewo, a po prawo jest ściana#}
            if((boardState[listOfNewLetters[0] + 1] != "" && ((listOfNewLetters[0] + 1) % 15 == 0))
                && (boardState[listOfNewLetters[0] - 1] != "" && ((listOfNewLetters[0] - 1) % 15 != 14)))
            {
                var check = true;
                var i = 1;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] - i];
                    wordBoardState.push(listOfNewLetters[0] - i);
                    i++;
                    if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0]-i % 15 == 14) {
                        check = false;
                    }
                }
                newWord = newWord.split('').reverse().join('');
                i = 1;
                listOfWords.push(newWord);
                listOfWordsAsBoardStates.push(wordBoardState.sort());
            }
            {#są kafelki po prawo a po lewo ściana#}
            if((boardState[listOfNewLetters[0] + 1] != "" && ((listOfNewLetters[0] + 1) % 15 != 0))
                && (boardState[listOfNewLetters[0] - 1] != "" && ((listOfNewLetters[0] - 1) % 15 == 14)))
            {
                var check = true;
                var i = 1;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] + i];
                    wordBoardState.push(listOfNewLetters[0] + 1);
                    i++;
                    if (boardState[listOfNewLetters[0] + i] == "" || listOfNewLetters[0] + i % 15 == 0) {
                        check = false;
                    }
                }
                listOfWords.push(newWord);
                listOfWordsAsBoardStates.push(wordBoardState);
            }
             {#kafelki na górze i na dole#}
             if(boardState[listOfNewLetters[0] + 15] != "" && boardState[listOfNewLetters[0] - 15] != "")
            {
                var check = true;
                var i = 15;
                var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                var wordBoardState = [listOfNewLetters[0]];
                while(check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] - i];
                    wordBoardState.push(listOfNewLetters[0] - 1);
                    i += 15;
                    if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0] - i < 0)
                    {
                        check = false;
                    }
                }
                newWord = newWord.split('').reverse().join('');
                i = 15;
                while(!check)
                {
                    newWord = newWord + boardState[listOfNewLetters[0] + i];
                    wordBoardState.push(listOfNewLetters[0] + 1);
                    i += 15;
                    if (boardState[listOfNewLetters[0] + i] == "" || listOfNewLetters[0] + i > 224)
                    {
                        check = true;
                    }
                }
                listOfWords.push(newWord);
                listOfWordsAsBoardStates.push(wordBoardState.sort());

            }
            return {listOfWords : listOfWords,
                    listOfWordsAsBoardStates: listOfWordsAsBoardStates};
        }
    }
    {#obsługa ruchu dla ciągu płytek#}
    else if(listOfNewLetters.length > 1)
    {
        {#walidacja ruchu (sprawdzanie sąsiadów postawionych płytek)#}
        var validation = false;
        for (i = 0; i < listOfNewLetters.length; i++)
        {
            if (((boardState[listOfNewLetters[i] - 1] != "")
                && ((listOfNewLetters[i] - 1) % 15 != 14)
                && (listOfNewLetters[i] - 1 >= 0))
                || ((boardState[listOfNewLetters[i] + 1] != "")
                    && ((listOfNewLetters[i] + 1) % 15 != 0)
                    && (listOfNewLetters[i] + 1 <= 224))
                || ((boardState[listOfNewLetters[i] - 15] != "")
                    && (listOfNewLetters[i] - 15 > 0))
                || ((boardState[listOfNewLetters[i] + 15] != "")
                    && (listOfNewLetters[i] + 15 < 224)))
            {
                validation = true;
            }
            if((listOfNewLetters[i + 1]) % 15 == 0) return false;
        }
        if(!validation) return false;
            {#w poziomie, w jednym ciągu#}
        if(listOfNewLetters[1] == listOfNewLetters[0] + 1
            && listOfNewLetters.length == listOfNewLetters[listOfNewLetters.length -1] - listOfNewLetters[0] + 1)
        {
                  {#po lewo od pierwszej płytki są inne płytki, po prawo od ostatniej, nie ma#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 != 14)
                      && boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] == "")
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];

                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i++;
                            if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0] - i ) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej są kafelki i po prawej są kafelki#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 != 14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 != 0 ))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];

                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);

                            i++;
                            if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);

                        }
                        i = 1;
                        check = true;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length - 1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);

                            i++;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == ""
                                || (listOfNewLetters[listOfNewLetters.length - 1] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej są kafelki a po prawej jest ściana#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 !=14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 == 0 ))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];

                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);

                            i++;
                            if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);

                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej jest ściana a po prawej są płytki#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 == 14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 != 0 ))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length - 1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);
                            i++;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == ""
                                || (listOfNewLetters[listOfNewLetters.length - 1] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {# po lewej nie ma płytek, po prawej są#}
                  if(boardState[listOfNewLetters[0] - 1] == ""
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && listOfNewLetters[listOfNewLetters.length - 1] + 1 != 0))
                    {

                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        var check = true;
                        var i = 1;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length-1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length-1] + i);

                            i++;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == ""
                                || (listOfNewLetters[listOfNewLetters.length - 1] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {# po lewej i po prawej nie ma płytek#}
                  if (boardState[listOfNewLetters[0] - 1] == ""
                      && boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] == "")
                  {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                       }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                  }
            {#sprawdzanie podsłów pionowych dla głównego słowa poziomego#}
            for (j = 0; j < listOfNewLetters.length; j++)
              {
                  {#nad literą są płytki, pod nie ma#}
                  if(boardState[listOfNewLetters[j] - 15] != "" && (boardState[listOfNewLetters[j] + 15] == "" || ( listOfNewLetters[j] + 15) > 224))
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] - i] == "" || listOfNewLetters[j] - i < 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord.split('').reverse().join(''));
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {# i nad i pod literą płytki#}
                  if(boardState[listOfNewLetters[j] - 15] != "" && boardState[listOfNewLetters[j] + 15] != "")
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] - i] == "" || listOfNewLetters[j] - i < 0)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        check = true;
                        i = 15;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] + i] == "" || listOfNewLetters[j] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#nad nie ma płytek, ale pod są#}
                  if((boardState[listOfNewLetters[j] - 15] == "" || (listOfNewLetters[j] - 15) < 0)  && boardState[listOfNewLetters[j] + 15] != "")
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] + i] == "" || listOfNewLetters[j] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
              }
            return {listOfWords : listOfWords,
                    listOfWordsAsBoardStates : listOfWordsAsBoardStates};
        }
        {#w pionie  w ciągu#}
        else if(listOfNewLetters[1] == listOfNewLetters[0] + 15
            && listOfNewLetters.length == ((listOfNewLetters[listOfNewLetters.length - 1] - listOfNewLetters[0]) / 15) + 1)
        {
                    {#na górze są litery, na dole nie ma#}
					if(boardState[listOfNewLetters[0] - 15] != ""
                      && (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] == ""
                            || (listOfNewLetters[listOfNewLetters.length - 1] + 15) > 224))
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0] - i < 0)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
					{#na górze są litery, na dole sa litery#}
                  if(boardState[listOfNewLetters[0] - 15] != ""
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] != "" && (listOfNewLetters[listOfNewLetters - 1] + 15 < 224)))
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0]-i);

                            i += 15;
                            if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0] - i < 0 )
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        i = 15;
                        check = true;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length - 1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);

                            i += 15;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == "" || listOfNewLetters[listOfNewLetters.length - 1] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#na górze nie ma, na dole są płytki#}
                  if((boardState[listOfNewLetters[0] - 15] == "" || listOfNewLetters[0] - 15 < 0)
                      &&  boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] != "")
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        var check = true;
                        var i = 15;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length-1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[listOfNewLetters - 1] + i] == "" || listOfNewLetters[listOfNewLetters.length - 1] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#nie ma ani na górze, ani na dole#}
                  if (boardState[listOfNewLetters[0] - 15] == ""
                      && boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] == "")
                  {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = 1; i < listOfNewLetters.length; i++)
                        {
                            newWord = newWord + boardStateToBe[listOfNewLetters[i]].innerText;
                            wordBoardState.push(listOfNewLetters[i]);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                  }
            {#sprawdzanie podsłów dla każdej litery#}
            for (j = 0; j < listOfNewLetters.length; j++)
              {
                  {#po lewej są płytki, po prawej nie ma#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 != 14 )
                      && boardState[listOfNewLetters[j] + 1] == "")
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i++;
                            if (boardState[listOfNewLetters[j] - i] == "" || (listOfNewLetters[j] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord.split('').reverse().join(''));
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej i prawej są płytki#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 != 14)
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 != 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i++;
                            if (boardState[listOfNewLetters[j] - i] == "" || (listOfNewLetters[j] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        check = true;
                        i = 1;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i++;
                            if (boardState[listOfNewLetters[j] + i] == "" || (listOfNewLetters[j] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej ściana a prawej są płytki#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 == 14)
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 != 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i++;
                            if (boardState[listOfNewLetters[j] + i] == "" || (listOfNewLetters[j] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort())
                    }
                  {#po lewej płytki a  po prawej ściana#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 != 14)
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 == 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i++;
                            if (boardState[listOfNewLetters[j] - i] == "" || (listOfNewLetters[j] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej nie ma płytki, po prawej jest#}
                  if(boardState[listOfNewLetters[j] - 1] == ""
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 != 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i++;
                            if (boardState[listOfNewLetters[j] + i] == "" || (listOfNewLetters[j] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
              }
            return {listOfWords : listOfWords,
                    listOfWordsAsBoardStates : listOfWordsAsBoardStates};
        }
        else
        {
            {#poziomo z przerwami na stare litery#}
            if ((15 - (listOfNewLetters[0] % 15)) >= listOfNewLetters[1] - listOfNewLetters[0])
            {
                {#walidacja#}
                for (i = 0; i < listOfNewLetters.length - 1; i++)
                {
                    for (j = listOfNewLetters[i] + 1; j < listOfNewLetters[i + 1]; j++)
                    {
                        if (boardState[j] == "" || listOfNewLetters[i + 1] % 15 == 0) return false;
                    }
                }
                {#po lewej są kafelki i po prawej są kafelki#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 != 14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 != 0 ))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];

                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i++;
                            if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);

                        }
                        i = 1;
                        check = true;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length - 1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);

                            i++;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == ""
                                || (listOfNewLetters[listOfNewLetters.length - 1] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej są kafelki i po prawej ściana#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 != 14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 == 0 ))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i++;
                            if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);

                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej ściana a po prawej są kafelki#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 == 14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 != 0 ))
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        var check = true;
                        var i = 1;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length - 1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);
                            i++;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == ""
                                || (listOfNewLetters[listOfNewLetters.length - 1] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej nie ma, a po prawej są kafelki#}
                  if(boardState[listOfNewLetters[0] - 1] == ""
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 != 0 ))
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        var check = true;
                        var i = 1;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length - 1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length - 1] + i);
                            i++;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == ""
                                || (listOfNewLetters[listOfNewLetters.length - 1] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej są kafelki, a po prawej nie ma#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 != 14)
                      &&  boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] == "" )
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i++;
                            if (boardState[listOfNewLetters[0] - i] == "" || (listOfNewLetters[0] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej i po prawej nie ma kafelkóe#}
                  if(boardState[listOfNewLetters[0] - 1] == ""
                      && boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] == "")
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState);
                    }
                  {#po lewej i po prawej ściana#}
                  if((boardState[listOfNewLetters[0] - 1] != "" && (listOfNewLetters[0] - 1) % 15 == 14)
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 1] != ""
                          && (listOfNewLetters[listOfNewLetters.length - 1] + 1) % 15 == 0 ))
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = listOfNewLetters[0] + 1; i <= listOfNewLetters[listOfNewLetters.length - 1]; i++)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                {#sprawdzanie podsłów pionowych dla głównego słowa poziomego#}
            for (j = 0; j < listOfNewLetters.length; j++)
              {
                  {#nad literą są płytki, pod nie ma#}
                  if(boardState[listOfNewLetters[j] - 15] != "" && (boardState[listOfNewLetters[j] + 15] == "" || (listOfNewLetters[j] + 15) > 224))
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] - i] == "" || listOfNewLetters[j] - i < 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord.split('').reverse().join(''));
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {# i nad i pod literą płytki#}
                  if(boardState[listOfNewLetters[j] - 15] != "" && boardState[listOfNewLetters[j] + 15] != "")
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] - i] == "" || listOfNewLetters[j] - i < 0)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        check = true;
                        i = 15;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] + i] == "" || listOfNewLetters[j] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#nad nie ma płytek, ale pod są#}
                  if((boardState[listOfNewLetters[j] - 15] == "" || (listOfNewLetters[j] - 15) < 0) && boardState[listOfNewLetters[j] + 15] != "")
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[j] + i] == "" || listOfNewLetters[j] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
              }
                return {listOfWords : listOfWords,
                        listOfWordsAsBoardStates : listOfWordsAsBoardStates};
            }
            else if ((listOfNewLetters[1] - listOfNewLetters[0]) % 15 == 0)
            {
                {#walidacja#}
                for (i = 0; i < listOfNewLetters.length - 1; i++)
                {
                    for (j = listOfNewLetters[i] + 15; j < listOfNewLetters[i + 1]; j += 15)
                    {
                        if (boardState[j] == "") return false;
                    }
                }
                {#na górze są litery, na dole sa litery#}
                  if(boardState[listOfNewLetters[0] - 15] != ""
                      &&  boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] != "")
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];

                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0] - i < 0 )
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = listOfNewLetters[0] + 15; i <= listOfNewLetters[listOfNewLetters.length - 1]; i += 15)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        i = 15;
                        check = true;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length-1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length-1] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == "" || listOfNewLetters[listOfNewLetters.length - 1] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                {#na górze są litery, na dole brak liter#}
                  if(boardState[listOfNewLetters[0] - 15] != ""
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] == "" || (listOfNewLetters[listOfNewLetters.length - 1] + 15) > 224))
                    {
                        var check = true;
                        var i = 15;
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[0] - i];
                            wordBoardState.push(listOfNewLetters[0] - i);
                            i += 15;
                            if (boardState[listOfNewLetters[0] - i] == "" || listOfNewLetters[0] - i < 0 )
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        for(i = listOfNewLetters[0] + 15; i <= listOfNewLetters[listOfNewLetters.length - 1]; i += 15)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                {#na górze brak liter, na dole sa litery#}
                  if((boardState[listOfNewLetters[0] - 15] == "" || (listOfNewLetters[0] - 15) < 0)
                      &&  boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] != "")
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = listOfNewLetters[0] + 15; i <= listOfNewLetters[listOfNewLetters.length - 1]; i += 15)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        var i = 15;
                        var check = true;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[listOfNewLetters.length-1] + i];
                            wordBoardState.push(listOfNewLetters[listOfNewLetters.length-1] + i);
                            i += 15;
                            if (boardState[listOfNewLetters[listOfNewLetters.length - 1] + i] == "" || listOfNewLetters[listOfNewLetters.length - 1] + i > 224)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                {#na górze i na dole brak liter#}
                  if((boardState[listOfNewLetters[0] - 15] == "" || (listOfNewLetters[0] - 15) < 0 )
                      &&  (boardState[listOfNewLetters[listOfNewLetters.length - 1] + 15] == "" || (listOfNewLetters[listOfNewLetters.length - 1] + 15) > 224))
                    {
                        var newWord = new String(boardStateToBe[listOfNewLetters[0]].innerText);
                        var wordBoardState = [listOfNewLetters[0]];
                        for(i = listOfNewLetters[0] + 15; i <= listOfNewLetters[listOfNewLetters.length - 1]; i += 15)
                        {
                            newWord = newWord + boardStateToBe[i].innerText;
                            wordBoardState.push(i);
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                {#sprawdzanie podsłów dla każdej litery#}
            for (j = 0; j < listOfNewLetters.length; j++)
              {
                  {#po lewej są płytki, po prawej nie ma#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 != 14 )
                      && boardState[listOfNewLetters[j] + 1] == "")
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i++;
                            if (boardState[listOfNewLetters[j] - i] == "" || (listOfNewLetters[j] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord.split('').reverse().join(''));
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej i prawej są płytki#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 != 14)
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 != 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i++;
                            if (boardState[listOfNewLetters[j] - i] == "" || (listOfNewLetters[j] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        check = true;
                        i = 1;
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i++;
                            if (boardState[listOfNewLetters[j] + i] == "" || (listOfNewLetters[j] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej ściana a prawej są płytki#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 == 14)
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 != 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i++;
                            if (boardState[listOfNewLetters[j] + i] == "" || (listOfNewLetters[j] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej płytki a  po prawej ściana#}
                  if((boardState[listOfNewLetters[j] - 1] != "" && (listOfNewLetters[j] - 1) % 15 != 14)
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 == 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] - i];
                            wordBoardState.push(listOfNewLetters[j] - i);
                            i++;
                            if (boardState[listOfNewLetters[j] - i] == "" || (listOfNewLetters[j] - i) % 15 == 14)
                            {
                                check = false;
                            }
                        }
                        newWord = newWord.split('').reverse().join('');
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
                  {#po lewej nie ma płytki, po prawej jest#}
                  if(boardState[listOfNewLetters[j] - 1] == ""
                      && (boardState[listOfNewLetters[j] + 1] != "" && (listOfNewLetters[j] + 1) % 15 != 0))
                    {
                        var check = true;
                        var i = 1;
                        var newWord = new String(boardStateToBe[listOfNewLetters[j]].innerText);
                        var wordBoardState = [listOfNewLetters[j]];
                        while(check)
                        {
                            newWord = newWord + boardState[listOfNewLetters[j] + i];
                            wordBoardState.push(listOfNewLetters[j] + i);
                            i++;
                            if (boardState[listOfNewLetters[j] + i] == "" || (listOfNewLetters[j] + i) % 15 == 0)
                            {
                                check = false;
                            }
                        }
                        listOfWords.push(newWord);
                        listOfWordsAsBoardStates.push(wordBoardState.sort());
                    }
              }
                return {listOfWords : listOfWords,
                        listOfWordsAsBoardStates : listOfWordsAsBoardStates};
            }
            return false;
        }
        return false;
    }
    return false;
}
function replaceLetters()
{
    var replace_container = document.getElementById("change").children;
    if(replace_container.length <= letters.length && replace_container.length != 0 )
    {
        fillLetters();
        for (i = 0; i < replace_container.length; i++)
        {
            letters.push(replace_container[i].innerText);
        }
        document.getElementById("change").innerHTML = " ";
    }
    else if(replace_container.length > letters.length && replace_container.length != 0)
    {
        alert("Nie ma wystarczająco płytek, by dokonać wymiany.")
    }
    else if(replace_container.length == 0)
    {
        alert("Nie dodano żadnych płytek do wymiany")
    }
}

var roomName = {{ gameroom_id_json }};
var round = 0;
var gameSocket = new WebSocket(
        'wss://' + window.location.host +
        '/ws/game/' + roomName + '/');

gameSocket.onmessage = function(e)
{
    var data = JSON.parse(e.data);
    var boardState = data['boardState'];
    if(boardState == "NOT YET")
    {
        alert("Oczekiwanie na ruch pozostałych graczy. Twoje ułożenie było warte " + data['points'] + " punktów.");
        document.getElementById("btn").hidden = true;
    }
    else if(boardState=="WAITING_FOR_START")
    {
        alert("Oczekiwanie na Start");
        document.getElementById("start").hidden = true;
    }
    else if (boardState =="START")
    {
        alert("Runda się rozpoczęła");
        round = data['round'];
        document.getElementById("btn").hidden = false;
        document.getElementById("round").innerText = "Runda: " + round;


    }
    else if(boardState == "LETTERS")
    {
        letters=data['lettersRemaining'];
        var lettersGiven = data['lettersGiven'];
        var dropzone_div = document.getElementById("letter");
        dropzone_div.innerHTML = lettersGiven;

    }
    else if (boardState == "LETTERS_PROVIDER")
    {
        var lettersGiven = fillLetters();
        gameSocket.send(JSON.stringify({
            'boardState': 'LETTERS',
            'lettersGiven': lettersGiven,
            'lettersRemaining': letters,
            'gameroom' : roomName,
            'round' : round
        }))
    }
    else if (boardState == 'WINNER')
    {
        alert()
    }
    else
    {
        {#var remainingLetters = data['remainingLetters'];#}
        applyReceivedData(boardState);
        document.getElementById("btn").hidden = false;
        round = data['round'];
        var winner = data['Winner'];
        if ('{{ user.username }}' == winner)
        {
            document.getElementsByClassName("points")[0].innerText = "Punkty: " + data['points'];
            var lettersGiven = fillLetters();
            gameSocket.send(JSON.stringify({
                'boardState': 'LETTERS',
                'lettersGiven': lettersGiven,
                'lettersRemaining': letters,
                'gameroom' : roomName,
                'round' : round
            }));
        }
        else
        {
            alert("Rundę wygrał gracz "+ winner + " zdobywając liczbę " + data['winnerPoints'] + " punktów.")
        }
        document.getElementById("round").innerText = "Runda: " + round;
        {#obsługa podmianki pozostalych liter, albo zmiana fillLetters, na wersję z argumentem#}

    }
};

gameSocket.onclose = function(e) {
    console.error('Chat socket closed unexpectedly');
};

document.querySelector('#btn').onclick = function(e) {

    var result = makeMove();
    if(result == undefined)
    {
        alert("Coś poszło nie tak, spróbuj wykonać ruch ponownie")
    }
    else
    {
        var wordList = result.wordList;
        var remainingLetters = result.remainingLetters;
        var wordListAsBoardState = result.wordListAsBoardState;
        var points = countValue(wordList, wordListAsBoardState);
        console.log(wordList);
        console.log(wordListAsBoardState);
        console.log(points);
        gameSocket.send(JSON.stringify({
            'points' : points,
            'boardState': boardState,
            'player' : '{{user.username}}',
            'gameroom' : roomName,
            'round' : round
        }));
    }
};

document.querySelector('#start').onclick = function(e) {
    gameSocket.send(JSON.stringify({
        'boardState' : 'READY',
        'player' : '{{user.username}}',
        'gameroom' : roomName,
        'round': round
    }));
};


{#window.onload = applyReceivedData;#}
    </script>
{#{% endblock %}#}

</body>
</html>